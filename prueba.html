<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Directo (Sin Lista)</title>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #eee; text-align: center; }
        #reader { width: 100%; max-width: 500px; margin: 0 auto; background: #000; }
        .btn { padding: 15px 30px; font-size: 18px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 20px 0; }
        #mensaje { margin-top: 10px; font-weight: bold; padding: 10px; }
        .error { color: white; background: red; }
        .ok { color: white; background: green; }
    </style>
</head>
<body>

    <h2>Lector QR - Modo Directo</h2>
    
    <button class="btn" onclick="iniciarCamara()">üì∏ Iniciar C√°mara Trasera</button>

    <div id="mensaje">Estado: Esperando...</div>
    <div id="reader"></div>

    <script>
        function log(texto, tipo = "normal") {
            const div = document.getElementById('mensaje');
            div.innerText = texto;
            div.className = tipo === "error" ? "error" : (tipo === "ok" ? "ok" : "");
        }

        function iniciarCamara() {
            // 1. VERIFICACI√ìN DE SEGURIDAD
            if (!window.isSecureContext) {
                log("‚ùå ERROR CR√çTICO: Est√°s abriendo el archivo como 'file://' o 'http://'. \n\nSOLUCI√ìN: Debes usar un servidor local (localhost) o HTTPS.", "error");
                return;
            }

            log("üîÑ Solicitando c√°mara trasera...");

            const html5QrCode = new Html5Qrcode("reader");

            // Configuraci√≥n directa: Pedimos "environment" (c√°mara trasera) sin listar dispositivos
            const config = { fps: 10, qrbox: { width: 250, height: 250 } };
            
            // Usamos el modo de restricciones directas
            html5QrCode.start(
                { facingMode: "environment" }, 
                config, 
                (decodedText) => {
                    log("‚úÖ QR DETECTADO: " + decodedText, "ok");
                    // html5QrCode.stop(); // Descomenta si quieres que pare al leer
                },
                (errorMessage) => {
                    // Ignoramos errores de lectura cuadro a cuadro
                }
            ).catch(err => {
                log("‚ùå ERROR AL INICIAR: " + err, "error");
                console.error(err);
            });
        }
    </script>
</body>
</html>
