
            usuarios.push({ usuario: usuario, contrasena: contrasena, rol: rol });
            localStorage.setItem('usuarios', JSON.stringify(usuarios));
            alert('Usuario registrado con éxito. Ahora puedes iniciar sesión.');
            document.getElementById('registro-form').reset();
            document.getElementById('registro').classList.add('hidden');
            document.getElementById('login').classList.remove('hidden');
        }

        function iniciarSesion() {
            let usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
            let usuario = document.getElementById('login_usuario').value;
            let contrasena = document.getElementById('login_contrasena').value;

            let usuarioEncontrado = usuarios.find(u => u.usuario === usuario && u.contrasena === contrasena);
            if (usuarioEncontrado) {
                usuarioActual = usuario; // Guardar el usuario actual
                rolActual = usuarioEncontrado.rol; // Guardar el rol del usuario actual
                document.getElementById('login').classList.add('hidden');
                document.getElementById('formulario').classList.remove('hidden');
                document.querySelector('input[name="asesor"]').value = usuarioActual; // Asignar usuario como asesor
                mostrarRegistros();
            } else {
                alert('Usuario o contraseña incorrectos.');
            }
        }

        function mostrarRegistro() {
            document.getElementById('login').classList.add('hidden');
            document.getElementById('registro').classList.remove('hidden');
        }

        function exportarAExcel() {
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(baseDatos, {
                header: ["fecha_hora", "codigo_unico", "cliente", "referencia", "asesor", "num_pares", "valor_total", "observaciones", "saldo_a_favor", "abonos"]
            });

            XLSX.utils.book_append_sheet(wb, ws, "Registros");
            XLSX.writeFile(wb, "registros.xlsx");
        }

        window.onload = function() {
            document.getElementById('login').classList.remove('hidden');
        }
    </script>
</head>
<body>
    <div class="container">
        <h1>Base de Datos con Autenticación</h1>
        <div id="login" class="hidden">
            <h2>Iniciar Sesión</h2>
            <form onsubmit="iniciarSesion(); return false;">
                <div class="form-field">
                    <label>Usuario:</label>
                    <input type="text" id="login_usuario" required>
                </div>
                <div class="form-field">
                    <label>Contraseña:</label>
                    <input type="password" id="login_contrasena" required>
                </div>
                <input type="submit" value="Iniciar Sesión">
                <button type="button" onclick="mostrarRegistro()">Registrar</button>
            </form>
        </div>
        <div id="registro" class="hidden">
            <h2>Registrar Usuario</h2>
            <form id="registro-form" onsubmit="registrarUsuario(); return false;">
                <div class="form-field">
                    <label>Usuario:</label>
                    <input type="text" id="reg_usuario" required>
                </div>
                <div class="form-field">
                    <label>Contraseña:</label>
                    <input type="password" id="reg_contrasena" required>
                </div>
                <div class="form-field">
                    <label>Rol:</label>
                    <select id="reg_rol" required>
                        <option value="Operario">Operario</option>
                        <option value="Administrador">Administrador</option>
                    </select>
                </div>
                <input type="submit" value="Registrar">
            </form>
        </div>
        <div id="formulario" class="hidden">
            <h2>Agregar Registro</h2>
            <form onsubmit="return enviarFormulario();">
                <div class="form-field">
                    <label>Nombre del Cliente:</label>
                    <input type="text" name="cliente" required>
                </div>
                <div class="form-field">
                    <label>Referencia, Color, Talla, Precio:</label>
                    <textarea name="referencia" rows="4" required></textarea> <!-- Cambiado a textarea -->
                </div>
                <div class="form-field">
                    <label>Nombre del Asesor:</label>
                    <input type="text" name="asesor" required readonly>
                </div>
                <div class="form-field">
                    <label>Número de Pares:</label>
                    <input type="number" name="num_pares" required>
                </div>
                <div class="form-field">
                    <label>Valor Total del Pedido:</label>
                    <input type="number" name="valor_total" required>
                </div>
                <div class="form-field">
                    <label>Observaciones:</label>
                    <textarea name="observaciones"></textarea>
                </div>
                <div class="form-field">
                    <label>Saldo a Favor:</label>
                    <input type="number" name="saldo_a_favor" required>
                </div>
                <div class="form-field">
                    <label>Abonos:</label>
                    <input type="number" name="abonos" required>
                </div>
                <input type="submit" value="Agregar">
            </form>

            <!-- Barra de carga -->
            <div id="loading-bar">
                <div id="loading-bar-fill">0%</div>
            </div>

            <h2>Registros</h2>
            <button id="exportar" class="hidden" onclick="exportarAExcel()">Exportar a Excel</button>
            <div id="registros"></div>
        </div>
    </div>
</body>
</html>
        function guardarEnBaseDeDatos(datos) {
            baseDatos.push(datos);
            localStorage.setItem('baseDatos', JSON.stringify(baseDatos));
        }

        function enviarFormulario() {
            mostrarBarraCargando();

            let fechaHora = new Date().toLocaleString();
            let codigoUnico = 'COD-' + Math.random().toString(36).substr(2, 9).toUpperCase();

            let datos = {
                fecha_hora: fechaHora,
                codigo_unico: codigoUnico,
                cliente: document.querySelector('input[name="cliente"]').value,
                referencia: document.querySelector('textarea[name="referencia"]').value,
                asesor: usuarioActual,
                num_pares: document.querySelector('input[name="num_pares"]').value,
                valor_total: document.querySelector('input[name="valor_total"]').value,
                observaciones: document.querySelector('textarea[name="observaciones"]').value,
                saldo_a_favor: document.querySelector('input[name="saldo_a_favor"]').value,
                abonos: document.querySelector('input[name="abonos"]').value
            };

            guardarEnBaseDeDatos(datos);
            mostrarRegistros();

            document.querySelector('form').reset();
            return false;
        }

        function mostrarRegistros() {
            let registrosHTML = '';
            baseDatos.forEach((registro, index) => {
                if (registro.asesor === usuarioActual || rolActual === 'Administrador') {
                    registrosHTML += `<div class="record">
                        <p><strong>Registro ${index + 1}</strong></p>
                        <p>Fecha y Hora: ${registro.fecha_hora}</p>
                        <p>Código Único: ${registro.codigo_unico}</p>
                        <p>Cliente: ${registro.cliente}</p>
                        <p>Referencia: ${registro.referencia.replace(/\n/g, '<br>')}</p>
                        <p>Asesor: ${registro.asesor}</p>
                        <p>Número de Pares: ${registro.num_pares}</p>
                        <p>Valor Total: ${registro.valor_total}</p>
                        <p>Observaciones: ${registro.observaciones}</p>
                        <p>Saldo a Favor: ${registro.saldo_a_favor}</p>
                        <p>Abonos: ${registro.abonos}</p>
                        <hr>
                    </div>`;
                }
            });
            document.getElementById('registros').innerHTML = registrosHTML;

            // Mostrar el botón de exportar a Excel si el usuario es administrador
            if (rolActual === 'Administrador') {
                document.getElementById('exportar').classList.remove('hidden');
            } else {
                document.getElementById('exportar').classList.add('hidden');
            }
        }
        function registrarUsuario() {
            let usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
            let usuario = document.getElementById('reg_usuario').value;
            let contrasena = document.getElementById('reg_contrasena').value;
            let rol = document.getElementById('reg_rol').value;

            if (usuarios.some(u => u.usuario === usuario)) {
                alert('El usuario ya existe.');
                return;
            }

            usuarios.push({ usuario: usuario, contrasena: contrasena, rol: rol });
            localStorage.setItem('usuarios', JSON.stringify(usuarios));
            alert('Usuario registrado con éxito. Ahora puedes iniciar sesión.');
            document.getElementById('registro-form').reset();
            document.getElementById('registro').classList.add('hidden');
            document.getElementById('login').classList.remove('hidden');
        }

        function iniciarSesion() {
            let usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
            let usuario = document.getElementById('login_usuario').value;
            let contrasena = document.getElementById('login_contrasena').value;

            let usuarioEncontrado = usuarios.find(u => u.usuario === usuario && u.contrasena === contrasena);
            if (usuarioEncontrado) {
                usuarioActual = usuario;
                rolActual = usuarioEncontrado.rol;
                document.getElementById('login').classList.add('hidden');
                document.getElementById('formulario').classList.remove('hidden');
                document.querySelector('input[name="asesor"]').value = usuarioActual;
                mostrarRegistros();
            } else {
                alert('Usuario o contraseña incorrectos.');
            }
        }

        function mostrarRegistro() {
            document.getElementById('login').classList.add('hidden');
            document.getElementById('registro').classList.remove('hidden');
        }

        function exportarAExcel() {
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(baseDatos, {
                header: ["fecha_hora", "codigo_unico", "cliente", "referencia", "asesor", "num_pares", "valor_total", "observaciones", "saldo_a_favor", "abonos"]
            });

            XLSX.utils.book_append_sheet(wb, ws, "Registros");
            XLSX.writeFile(wb, "registros.xlsx");
        }

        window.onload = function() {
            document.getElementById('login').classList.remove('hidden');
        }
    </script>
</head>
<body>
    <div class="container">
        <h1>Base de Datos con Autenticación</h1>
        <div id="login">
            <h2>Iniciar Sesión</h2>
            <form onsubmit="iniciarSesion(); return false;">
                <div class="form-field">
                    <label>Usuario:</label>
                    <input type="text" id="login_usuario" required>
                </div>
                <div class="form-field">
                    <label>Contraseña:</label>
                    <input type="password" id="login_contrasena" required>
                </div>
                <input type="submit" value="Iniciar Sesión">
                <button type="button" onclick="mostrarRegistro()">Registrar</button>
            </form>
        </div>
        <div id="registro" class="hidden">
            <h2>Registrar Usuario</h2>
            <form id="registro-form" onsubmit="registrarUsuario(); return false;">
                <div class="form-field">
                    <label>Usuario:</label>
                    <input type="text" id="reg_usuario" required>
                </div>
                <div class="form-field">
                    <label>Contraseña:</label>
                    <input type="password" id="reg_contrasena" required>
                </div>
                <div class="form-field">
                    <label>Rol:</label>
                    <select id="reg_rol" required>
                        <option value="Operario">Operario</option>
                        <option value="Administrador">Administrador</option>
                    </select>
                </div>
                <input type="submit" value="Registrar">
                <button type="button" onclick="regresarLogin()">Regresar</button>
            </form>
        </div>
        <div id="formulario" class="hidden">
            <h2>Agregar Registro</h2>
            <form onsubmit="return enviarFormulario();">
                <div class="form-field">
                    <label>Nombre del Cliente:</label>
                    <input type="text" name="cliente" required>
                </div>
                <div class="form-field">
                    <label>Referencia, Color, Talla, Precio:</label>
                    <textarea name="referencia" rows="4" required></textarea>
                </div>
                <div class="form-field">
                    <label>Nombre del Asesor:</label>
                    <input type="text" name="asesor" required readonly>
                </div>
                <div class="form-field">
                    <label>Número de Pares:</label>
                    <input type="number" name="num_pares" required>
                </div>
                <div class="form-field">
                    <label>Valor Total del Pedido:</label>
                    <input type="number" name="valor_total" required>
                </div>
                <div class="form-field">
                    <label>Observaciones:</label>
                    <textarea name="observaciones"></textarea>
                </div>
                <div class="form-field">
                    <label>Saldo a Favor:</label>
                    <input type="number" name="saldo_a_favor" required>
                </div>
                <div class="form-field">
                    <label>Abonos:</label>
                    <input type="number" name="abonos" required>
                </div>
                <input type="submit" value="Agregar">
            </form>

            <!-- Barra de carga -->
            <div id="loading-bar">
                <div id="loading-bar-fill">0%</div>
            </div>

            <h2>Registros</h2>
            <button id="exportar" class="hidden" onclick="exportarAExcel()">Exportar a Excel</button>
            <div id="registros"></div>
            <button type="button" onclick="regresarLogin()">Regresar</button>
        </div>
    </div>
</body>
</html>
