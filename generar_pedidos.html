<!DOCTYPE html>
<html>
<head>
    <title>Generar Pedidos</title>
    <style>
        /* Estilos existentes */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            height: 100vh;
        }
        .container {
            width: 90%;
            max-width: 800px;
            margin: 20px;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow-y: auto;
            max-height: 90vh;
        }
        h1, h2 {
            color: #4CAF50;
            text-align: center;
        }
        .form-field {
            display: flex;
            flex-direction: column;
            margin-bottom: 10px;
        }
        input, textarea, button {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            position: relative;
            margin: auto;
            top: 3px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 18px;
            cursor: pointer;
        }
        .record {
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <div class="container">
        <h1>Generar Pedidos</h1>
        <form onsubmit="enviarFormulario(event);">
            <div class="form-field">
                <label>Nombre del Cliente:</label>
                <input type="text" id="cliente" required>
            </div>
            <div class="form-field">
                <label>Productos:</label>
                <button type="button" onclick="mostrarModal('modal_producto')">Agregar Producto</button>
            </div>
            <div id="lista_productos" class="form-field"></div>
            <div class="form-field">
                <label>Valor Total:</label>
                <input type="number" id="valor_total" readonly>
            </div>
            <input type="submit" value="Agregar Pedido">
        </form>

        <h2>Registros</h2>
        <button onclick="verPedidos()">Ver Pedidos</button>
    </div>

    <!-- Modal para agregar productos -->
    <div id="modal_producto" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('modal_producto')">&times;</span>
            <h2>Agregar Producto</h2>
            <div class="form-field">
                <label>Referencia:</label>
                <input type="text" id="producto_referencia" required>
            </div>
            <div class="form-field">
                <label>Precio:</label>
                <input type="number" id="producto_precio" required>
            </div>
            <button onclick="agregarProducto()">Agregar</button>
        </div>
    </div>

    <!-- Modal para ver pedidos -->
    <div id="modal_pedidos" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('modal_pedidos')">&times;</span>
            <h2>Pedidos</h2>
            <div id="lista_pedidos"></div>
        </div>
    </div>

    <!-- Modal para modificar pedido -->
    <div id="modal_modificar" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('modal_modificar')">&times;</span>
            <h2>Modificar Pedido</h2>
            <div class="form-field">
                <label>Cliente:</label>
                <input type="text" id="modificar_cliente">
            </div>
            <button onclick="guardarCambios()">Guardar Cambios</button>
        </div>
    </div>

    <script>
        let productos = [];
        let pedidos = [];
        let idEditar = null;

        const mostrarModal = id => document.getElementById(id).style.display = 'flex';
        const cerrarModal = id => document.getElementById(id).style.display = 'none';

        function agregarProducto() {
            const referencia = document.getElementById('producto_referencia').value;
            const precio = parseFloat(document.getElementById('producto_precio').value);
            productos.push({ referencia, precio });
            actualizarListaProductos();
            cerrarModal('modal_producto');
        }

        function actualizarListaProductos() {
            const lista = document.getElementById('lista_productos');
            lista.innerHTML = '';
            productos.forEach((producto, index) => {
                lista.innerHTML += `<div class="record">
                    <p>${producto.referencia} - $${producto.precio}</p>
                    <button onclick="eliminarProducto(${index})">Eliminar</button>
                </div>`;
            });
            actualizarValorTotal();
        }

        function eliminarProducto(index) {
            productos.splice(index, 1);
            actualizarListaProductos();
        }

        function actualizarValorTotal() {
            const total = productos.reduce((sum, producto) => sum + producto.precio, 0);
            document.getElementById('valor_total').value = total;
        }

        function enviarFormulario(event) {
            event.preventDefault();
            const cliente = document.getElementById('cliente').value;
            const valorTotal = parseFloat(document.getElementById('valor_total').value);
            pedidos.push({ cliente, productos: [...productos], valorTotal });
            productos = [];
            document.getElementById('cliente').value = '';
            actualizarListaProductos();
            alert('Pedido agregado');
        }

        function verPedidos() {
            const lista = document.getElementById('lista_pedidos');
            lista.innerHTML = '';
            pedidos.forEach((pedido, index) => {
                lista.innerHTML += `<div class="record">
                    <p><strong>${pedido.cliente}</strong></p>
                    <p>Valor Total: $${pedido.valorTotal}</p>
                    <button onclick="modificarPedido(${index})">Modificar</button>
                    <button onclick="eliminarPedido(${index})">Eliminar</button>
                </div>`;
            });
            mostrarModal('modal_pedidos');
        }

        function modificarPedido(index) {
            idEditar = index;
            const pedido = pedidos[index];
            document.getElementById('modificar_cliente').value = pedido.cliente;
            mostrarModal('modal_modificar');
        }

        function guardarCambios() {
            const cliente = document.getElementById('modificar_cliente').value;
            if (idEditar !== null) {
                pedidos[idEditar].cliente = cliente;
                idEditar = null;
            }
            cerrarModal('modal_modificar');
            verPedidos();
        }

        function eliminarPedido(index) {
            pedidos.splice(index, 1);
            verPedidos();
        }
    </script>
</body>
</html>
